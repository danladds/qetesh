/* ModuleManager.c generated by valac 0.22.1, the Vala compiler
 * generated from ModuleManager.vala, do not modify */

/*
 * ModuleManager.vala
 * 
 * Copyright 2014 Dan Ladds <Dan@el-topo.co.uk>
 * 
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 * 
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 * 
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston,
 * MA 02110-1301, USA.
 * 
 * 
 */

#include <glib.h>
#include <glib-object.h>
#include <gee.h>
#include <stdlib.h>
#include <string.h>


#define QETESH_TYPE_MODULE_MANAGER (qetesh_module_manager_get_type ())
#define QETESH_MODULE_MANAGER(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), QETESH_TYPE_MODULE_MANAGER, QeteshModuleManager))
#define QETESH_MODULE_MANAGER_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), QETESH_TYPE_MODULE_MANAGER, QeteshModuleManagerClass))
#define QETESH_IS_MODULE_MANAGER(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), QETESH_TYPE_MODULE_MANAGER))
#define QETESH_IS_MODULE_MANAGER_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), QETESH_TYPE_MODULE_MANAGER))
#define QETESH_MODULE_MANAGER_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), QETESH_TYPE_MODULE_MANAGER, QeteshModuleManagerClass))

typedef struct _QeteshModuleManager QeteshModuleManager;
typedef struct _QeteshModuleManagerClass QeteshModuleManagerClass;
typedef struct _QeteshModuleManagerPrivate QeteshModuleManagerPrivate;

#define QETESH_TYPE_APP_MODULE (qetesh_app_module_get_type ())
#define QETESH_APP_MODULE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), QETESH_TYPE_APP_MODULE, QeteshAppModule))
#define QETESH_APP_MODULE_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), QETESH_TYPE_APP_MODULE, QeteshAppModuleClass))
#define QETESH_IS_APP_MODULE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), QETESH_TYPE_APP_MODULE))
#define QETESH_IS_APP_MODULE_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), QETESH_TYPE_APP_MODULE))
#define QETESH_APP_MODULE_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), QETESH_TYPE_APP_MODULE, QeteshAppModuleClass))

typedef struct _QeteshAppModule QeteshAppModule;
typedef struct _QeteshAppModuleClass QeteshAppModuleClass;

#define QETESH_TYPE_WEB_SERVER_CONTEXT (qetesh_web_server_context_get_type ())
#define QETESH_WEB_SERVER_CONTEXT(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), QETESH_TYPE_WEB_SERVER_CONTEXT, QeteshWebServerContext))
#define QETESH_WEB_SERVER_CONTEXT_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), QETESH_TYPE_WEB_SERVER_CONTEXT, QeteshWebServerContextClass))
#define QETESH_IS_WEB_SERVER_CONTEXT(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), QETESH_TYPE_WEB_SERVER_CONTEXT))
#define QETESH_IS_WEB_SERVER_CONTEXT_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), QETESH_TYPE_WEB_SERVER_CONTEXT))
#define QETESH_WEB_SERVER_CONTEXT_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), QETESH_TYPE_WEB_SERVER_CONTEXT, QeteshWebServerContextClass))

typedef struct _QeteshWebServerContext QeteshWebServerContext;
typedef struct _QeteshWebServerContextClass QeteshWebServerContextClass;
#define _g_object_unref0(var) ((var == NULL) ? NULL : (var = (g_object_unref (var), NULL)))
typedef struct _QeteshWebServerContextPrivate QeteshWebServerContextPrivate;

#define QETESH_TYPE_ERROR_MANAGER (qetesh_error_manager_get_type ())
#define QETESH_ERROR_MANAGER(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), QETESH_TYPE_ERROR_MANAGER, QeteshErrorManager))
#define QETESH_ERROR_MANAGER_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), QETESH_TYPE_ERROR_MANAGER, QeteshErrorManagerClass))
#define QETESH_IS_ERROR_MANAGER(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), QETESH_TYPE_ERROR_MANAGER))
#define QETESH_IS_ERROR_MANAGER_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), QETESH_TYPE_ERROR_MANAGER))
#define QETESH_ERROR_MANAGER_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), QETESH_TYPE_ERROR_MANAGER, QeteshErrorManagerClass))

typedef struct _QeteshErrorManager QeteshErrorManager;
typedef struct _QeteshErrorManagerClass QeteshErrorManagerClass;

#define QETESH_DATA_TYPE_DB_MANAGER (qetesh_data_db_manager_get_type ())
#define QETESH_DATA_DB_MANAGER(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), QETESH_DATA_TYPE_DB_MANAGER, QeteshDataDBManager))
#define QETESH_DATA_DB_MANAGER_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), QETESH_DATA_TYPE_DB_MANAGER, QeteshDataDBManagerClass))
#define QETESH_DATA_IS_DB_MANAGER(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), QETESH_DATA_TYPE_DB_MANAGER))
#define QETESH_DATA_IS_DB_MANAGER_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), QETESH_DATA_TYPE_DB_MANAGER))
#define QETESH_DATA_DB_MANAGER_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), QETESH_DATA_TYPE_DB_MANAGER, QeteshDataDBManagerClass))

typedef struct _QeteshDataDBManager QeteshDataDBManager;
typedef struct _QeteshDataDBManagerClass QeteshDataDBManagerClass;

#define QETESH_TYPE_CONFIG_FILE (qetesh_config_file_get_type ())
#define QETESH_CONFIG_FILE(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), QETESH_TYPE_CONFIG_FILE, QeteshConfigFile))
#define QETESH_CONFIG_FILE_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), QETESH_TYPE_CONFIG_FILE, QeteshConfigFileClass))
#define QETESH_IS_CONFIG_FILE(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), QETESH_TYPE_CONFIG_FILE))
#define QETESH_IS_CONFIG_FILE_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), QETESH_TYPE_CONFIG_FILE))
#define QETESH_CONFIG_FILE_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), QETESH_TYPE_CONFIG_FILE, QeteshConfigFileClass))

typedef struct _QeteshConfigFile QeteshConfigFile;
typedef struct _QeteshConfigFileClass QeteshConfigFileClass;

#define QETESH_ERROR_MANAGER_TYPE_QERROR_CLASS (qetesh_error_manager_qerror_class_get_type ())

#define QETESH_CONFIG_FILE_TYPE_MOD_CONFIG (qetesh_config_file_mod_config_get_type ())
#define QETESH_CONFIG_FILE_MOD_CONFIG(obj) (G_TYPE_CHECK_INSTANCE_CAST ((obj), QETESH_CONFIG_FILE_TYPE_MOD_CONFIG, QeteshConfigFileModConfig))
#define QETESH_CONFIG_FILE_MOD_CONFIG_CLASS(klass) (G_TYPE_CHECK_CLASS_CAST ((klass), QETESH_CONFIG_FILE_TYPE_MOD_CONFIG, QeteshConfigFileModConfigClass))
#define QETESH_CONFIG_FILE_IS_MOD_CONFIG(obj) (G_TYPE_CHECK_INSTANCE_TYPE ((obj), QETESH_CONFIG_FILE_TYPE_MOD_CONFIG))
#define QETESH_CONFIG_FILE_IS_MOD_CONFIG_CLASS(klass) (G_TYPE_CHECK_CLASS_TYPE ((klass), QETESH_CONFIG_FILE_TYPE_MOD_CONFIG))
#define QETESH_CONFIG_FILE_MOD_CONFIG_GET_CLASS(obj) (G_TYPE_INSTANCE_GET_CLASS ((obj), QETESH_CONFIG_FILE_TYPE_MOD_CONFIG, QeteshConfigFileModConfigClass))

typedef struct _QeteshConfigFileModConfig QeteshConfigFileModConfig;
typedef struct _QeteshConfigFileModConfigClass QeteshConfigFileModConfigClass;
typedef struct _QeteshConfigFileModConfigPrivate QeteshConfigFileModConfigPrivate;
#define _g_free0(var) (var = (g_free (var), NULL))
#define _qetesh_config_file_mod_config_unref0(var) ((var == NULL) ? NULL : (var = (qetesh_config_file_mod_config_unref (var), NULL)))
#define _g_error_free0(var) ((var == NULL) ? NULL : (var = (g_error_free (var), NULL)))

struct _QeteshModuleManager {
	GObject parent_instance;
	QeteshModuleManagerPrivate * priv;
};

struct _QeteshModuleManagerClass {
	GObjectClass parent_class;
};

struct _QeteshModuleManagerPrivate {
	GeeArrayList* loadedModules;
	GeeTreeMap* hostModules;
	QeteshWebServerContext* context;
};

struct _QeteshWebServerContext {
	GObject parent_instance;
	QeteshWebServerContextPrivate * priv;
	QeteshErrorManager* Err;
	QeteshDataDBManager* Databases;
	QeteshModuleManager* Modules;
	QeteshConfigFile* Configuration;
};

struct _QeteshWebServerContextClass {
	GObjectClass parent_class;
};

typedef enum  {
	QETESH_ERROR_MANAGER_QERROR_CLASS_QETESH_ERROR,
	QETESH_ERROR_MANAGER_QERROR_CLASS_QETESH_CRITICAL,
	QETESH_ERROR_MANAGER_QERROR_CLASS_QETESH_DEBUG,
	QETESH_ERROR_MANAGER_QERROR_CLASS_QETESH_WARNING,
	QETESH_ERROR_MANAGER_QERROR_CLASS_QETESH_BEST_PRACTICE,
	QETESH_ERROR_MANAGER_QERROR_CLASS_QETESH_INTERNAL,
	QETESH_ERROR_MANAGER_QERROR_CLASS_QETESH_INTERNAL_DEV,
	QETESH_ERROR_MANAGER_QERROR_CLASS_MODULE_ERROR,
	QETESH_ERROR_MANAGER_QERROR_CLASS_MODULE_CRITICAL,
	QETESH_ERROR_MANAGER_QERROR_CLASS_MODULE_DEBUG,
	QETESH_ERROR_MANAGER_QERROR_CLASS_MODULE_WARNING
} QeteshErrorManagerQErrorClass;

struct _QeteshConfigFileModConfig {
	GTypeInstance parent_instance;
	volatile int ref_count;
	QeteshConfigFileModConfigPrivate * priv;
	gchar* LibPath;
	gchar* LoaderName;
	gchar* Nick;
	GeeLinkedList* Hosts;
};

struct _QeteshConfigFileModConfigClass {
	GTypeClass parent_class;
	void (*finalize) (QeteshConfigFileModConfig *self);
};

typedef enum  {
	QETESH_ERRORS_QMODULE_ERROR_LOAD,
	QETESH_ERRORS_QMODULE_ERROR_CONFIG,
	QETESH_ERRORS_QMODULE_ERROR_STRUCTURE
} QeteshErrorsQModuleError;
#define QETESH_ERRORS_QMODULE_ERROR qetesh_errors_qmodule_error_quark ()

static gpointer qetesh_module_manager_parent_class = NULL;

GType qetesh_module_manager_get_type (void) G_GNUC_CONST;
GType qetesh_app_module_get_type (void) G_GNUC_CONST;
GType qetesh_web_server_context_get_type (void) G_GNUC_CONST;
#define QETESH_MODULE_MANAGER_GET_PRIVATE(o) (G_TYPE_INSTANCE_GET_PRIVATE ((o), QETESH_TYPE_MODULE_MANAGER, QeteshModuleManagerPrivate))
enum  {
	QETESH_MODULE_MANAGER_DUMMY_PROPERTY
};
QeteshModuleManager* qetesh_module_manager_new (QeteshWebServerContext* c);
QeteshModuleManager* qetesh_module_manager_construct (GType object_type, QeteshWebServerContext* c);
void qetesh_module_manager_LoadModules (QeteshModuleManager* self);
GType qetesh_error_manager_get_type (void) G_GNUC_CONST;
GType qetesh_data_db_manager_get_type (void) G_GNUC_CONST;
GType qetesh_config_file_get_type (void) G_GNUC_CONST;
GType qetesh_error_manager_qerror_class_get_type (void) G_GNUC_CONST;
void qetesh_error_manager_WriteMessage (QeteshErrorManager* self, const gchar* message, QeteshErrorManagerQErrorClass errorClass, const gchar* modName);
gpointer qetesh_config_file_mod_config_ref (gpointer instance);
void qetesh_config_file_mod_config_unref (gpointer instance);
GParamSpec* qetesh_config_file_param_spec_mod_config (const gchar* name, const gchar* nick, const gchar* blurb, GType object_type, GParamFlags flags);
void qetesh_config_file_value_set_mod_config (GValue* value, gpointer v_object);
void qetesh_config_file_value_take_mod_config (GValue* value, gpointer v_object);
gpointer qetesh_config_file_value_get_mod_config (const GValue* value);
GType qetesh_config_file_mod_config_get_type (void) G_GNUC_CONST;
GeeLinkedList* qetesh_config_file_get_Modules (QeteshConfigFile* self);
static void qetesh_module_manager_loadModule (QeteshModuleManager* self, QeteshConfigFileModConfig* mod);
GQuark qetesh_errors_qmodule_error_quark (void);
QeteshAppModule* qetesh_app_module_new (const gchar* modPath, const gchar* nick, const gchar* loader, QeteshWebServerContext* sc, GError** error);
QeteshAppModule* qetesh_app_module_construct (GType object_type, const gchar* modPath, const gchar* nick, const gchar* loader, QeteshWebServerContext* sc, GError** error);
const gchar* qetesh_app_module_get_Nick (QeteshAppModule* self);
QeteshAppModule* qetesh_module_manager_GetHostModule (QeteshModuleManager* self, const gchar* host);
static void qetesh_module_manager_finalize (GObject* obj);


static gpointer _g_object_ref0 (gpointer self) {
	return self ? g_object_ref (self) : NULL;
}


QeteshModuleManager* qetesh_module_manager_construct (GType object_type, QeteshWebServerContext* c) {
	QeteshModuleManager * self = NULL;
	QeteshWebServerContext* _tmp0_ = NULL;
	QeteshWebServerContext* _tmp1_ = NULL;
	GeeArrayList* _tmp2_ = NULL;
	GeeTreeMap* _tmp3_ = NULL;
	g_return_val_if_fail (c != NULL, NULL);
	self = (QeteshModuleManager*) g_object_new (object_type, NULL);
	_tmp0_ = c;
	_tmp1_ = _g_object_ref0 (_tmp0_);
	_g_object_unref0 (self->priv->context);
	self->priv->context = _tmp1_;
	_tmp2_ = gee_array_list_new (QETESH_TYPE_APP_MODULE, (GBoxedCopyFunc) g_object_ref, g_object_unref, NULL, NULL, NULL);
	_g_object_unref0 (self->priv->loadedModules);
	self->priv->loadedModules = _tmp2_;
	_tmp3_ = gee_tree_map_new (G_TYPE_STRING, (GBoxedCopyFunc) g_strdup, g_free, QETESH_TYPE_APP_MODULE, (GBoxedCopyFunc) g_object_ref, g_object_unref, NULL, NULL, NULL, NULL, NULL, NULL);
	_g_object_unref0 (self->priv->hostModules);
	self->priv->hostModules = _tmp3_;
	return self;
}


QeteshModuleManager* qetesh_module_manager_new (QeteshWebServerContext* c) {
	return qetesh_module_manager_construct (QETESH_TYPE_MODULE_MANAGER, c);
}


/**
* Load appropriate modules
**/
void qetesh_module_manager_LoadModules (QeteshModuleManager* self) {
	QeteshWebServerContext* _tmp0_ = NULL;
	QeteshErrorManager* _tmp1_ = NULL;
	g_return_if_fail (self != NULL);
	_tmp0_ = self->priv->context;
	_tmp1_ = _tmp0_->Err;
	qetesh_error_manager_WriteMessage (_tmp1_, "ModuleManager loading modules", QETESH_ERROR_MANAGER_QERROR_CLASS_QETESH_DEBUG, NULL);
	{
		GeeLinkedList* _mod_list = NULL;
		QeteshWebServerContext* _tmp2_ = NULL;
		QeteshConfigFile* _tmp3_ = NULL;
		GeeLinkedList* _tmp4_ = NULL;
		GeeLinkedList* _tmp5_ = NULL;
		GeeLinkedList* _tmp6_ = NULL;
		gint _mod_size = 0;
		GeeLinkedList* _tmp7_ = NULL;
		gint _tmp8_ = 0;
		gint _tmp9_ = 0;
		gint _mod_index = 0;
		_tmp2_ = self->priv->context;
		_tmp3_ = _tmp2_->Configuration;
		_tmp4_ = qetesh_config_file_get_Modules (_tmp3_);
		_tmp5_ = _tmp4_;
		_tmp6_ = _g_object_ref0 (_tmp5_);
		_mod_list = _tmp6_;
		_tmp7_ = _mod_list;
		_tmp8_ = gee_abstract_collection_get_size ((GeeCollection*) _tmp7_);
		_tmp9_ = _tmp8_;
		_mod_size = _tmp9_;
		_mod_index = -1;
		while (TRUE) {
			gint _tmp10_ = 0;
			gint _tmp11_ = 0;
			gint _tmp12_ = 0;
			QeteshConfigFileModConfig* mod = NULL;
			GeeLinkedList* _tmp13_ = NULL;
			gint _tmp14_ = 0;
			gpointer _tmp15_ = NULL;
			QeteshWebServerContext* _tmp16_ = NULL;
			QeteshErrorManager* _tmp17_ = NULL;
			QeteshConfigFileModConfig* _tmp18_ = NULL;
			const gchar* _tmp19_ = NULL;
			QeteshConfigFileModConfig* _tmp20_ = NULL;
			const gchar* _tmp21_ = NULL;
			QeteshConfigFileModConfig* _tmp22_ = NULL;
			const gchar* _tmp23_ = NULL;
			gchar* _tmp24_ = NULL;
			gchar* _tmp25_ = NULL;
			QeteshConfigFileModConfig* _tmp26_ = NULL;
			_tmp10_ = _mod_index;
			_mod_index = _tmp10_ + 1;
			_tmp11_ = _mod_index;
			_tmp12_ = _mod_size;
			if (!(_tmp11_ < _tmp12_)) {
				break;
			}
			_tmp13_ = _mod_list;
			_tmp14_ = _mod_index;
			_tmp15_ = gee_abstract_list_get ((GeeAbstractList*) _tmp13_, _tmp14_);
			mod = (QeteshConfigFileModConfig*) _tmp15_;
			_tmp16_ = self->priv->context;
			_tmp17_ = _tmp16_->Err;
			_tmp18_ = mod;
			_tmp19_ = _tmp18_->Nick;
			_tmp20_ = mod;
			_tmp21_ = _tmp20_->LoaderName;
			_tmp22_ = mod;
			_tmp23_ = _tmp22_->LibPath;
			_tmp24_ = g_strdup_printf ("Loading module: %s %s %s", _tmp19_, _tmp21_, _tmp23_);
			_tmp25_ = _tmp24_;
			qetesh_error_manager_WriteMessage (_tmp17_, _tmp25_, QETESH_ERROR_MANAGER_QERROR_CLASS_QETESH_DEBUG, NULL);
			_g_free0 (_tmp25_);
			_tmp26_ = mod;
			qetesh_module_manager_loadModule (self, _tmp26_);
			_qetesh_config_file_mod_config_unref0 (mod);
		}
		_g_object_unref0 (_mod_list);
	}
}


/**
* Load a specified module
* 
* @param path File path to module library file
* @param name Type name of the primary element class
**/
static void qetesh_module_manager_loadModule (QeteshModuleManager* self, QeteshConfigFileModConfig* mod) {
	GError * _inner_error_ = NULL;
	g_return_if_fail (self != NULL);
	g_return_if_fail (mod != NULL);
	{
		QeteshWebServerContext* _tmp0_ = NULL;
		QeteshErrorManager* _tmp1_ = NULL;
		QeteshConfigFileModConfig* _tmp2_ = NULL;
		const gchar* _tmp3_ = NULL;
		gchar* _tmp4_ = NULL;
		gchar* _tmp5_ = NULL;
		QeteshAppModule* loadedMod = NULL;
		QeteshConfigFileModConfig* _tmp6_ = NULL;
		const gchar* _tmp7_ = NULL;
		QeteshConfigFileModConfig* _tmp8_ = NULL;
		const gchar* _tmp9_ = NULL;
		QeteshConfigFileModConfig* _tmp10_ = NULL;
		const gchar* _tmp11_ = NULL;
		QeteshWebServerContext* _tmp12_ = NULL;
		QeteshAppModule* _tmp13_ = NULL;
		GeeArrayList* _tmp14_ = NULL;
		QeteshAppModule* _tmp15_ = NULL;
		QeteshWebServerContext* _tmp16_ = NULL;
		QeteshErrorManager* _tmp17_ = NULL;
		QeteshConfigFileModConfig* _tmp18_ = NULL;
		const gchar* _tmp19_ = NULL;
		gchar* _tmp20_ = NULL;
		gchar* _tmp21_ = NULL;
		_tmp0_ = self->priv->context;
		_tmp1_ = _tmp0_->Err;
		_tmp2_ = mod;
		_tmp3_ = _tmp2_->Nick;
		_tmp4_ = g_strdup_printf ("Loading module: %s", _tmp3_);
		_tmp5_ = _tmp4_;
		qetesh_error_manager_WriteMessage (_tmp1_, _tmp5_, QETESH_ERROR_MANAGER_QERROR_CLASS_QETESH_DEBUG, NULL);
		_g_free0 (_tmp5_);
		_tmp6_ = mod;
		_tmp7_ = _tmp6_->LibPath;
		_tmp8_ = mod;
		_tmp9_ = _tmp8_->Nick;
		_tmp10_ = mod;
		_tmp11_ = _tmp10_->LoaderName;
		_tmp12_ = self->priv->context;
		_tmp13_ = qetesh_app_module_new (_tmp7_, _tmp9_, _tmp11_, _tmp12_, &_inner_error_);
		loadedMod = _tmp13_;
		if (_inner_error_ != NULL) {
			goto __catch3_g_error;
		}
		_tmp14_ = self->priv->loadedModules;
		_tmp15_ = loadedMod;
		gee_abstract_collection_add ((GeeAbstractCollection*) _tmp14_, _tmp15_);
		_tmp16_ = self->priv->context;
		_tmp17_ = _tmp16_->Err;
		_tmp18_ = mod;
		_tmp19_ = _tmp18_->Nick;
		_tmp20_ = g_strdup_printf ("Loaded module: %s", _tmp19_);
		_tmp21_ = _tmp20_;
		qetesh_error_manager_WriteMessage (_tmp17_, _tmp21_, QETESH_ERROR_MANAGER_QERROR_CLASS_QETESH_DEBUG, NULL);
		_g_free0 (_tmp21_);
		{
			GeeLinkedList* _host_list = NULL;
			QeteshConfigFileModConfig* _tmp22_ = NULL;
			GeeLinkedList* _tmp23_ = NULL;
			GeeLinkedList* _tmp24_ = NULL;
			gint _host_size = 0;
			GeeLinkedList* _tmp25_ = NULL;
			gint _tmp26_ = 0;
			gint _tmp27_ = 0;
			gint _host_index = 0;
			_tmp22_ = mod;
			_tmp23_ = _tmp22_->Hosts;
			_tmp24_ = _g_object_ref0 (_tmp23_);
			_host_list = _tmp24_;
			_tmp25_ = _host_list;
			_tmp26_ = gee_abstract_collection_get_size ((GeeCollection*) _tmp25_);
			_tmp27_ = _tmp26_;
			_host_size = _tmp27_;
			_host_index = -1;
			while (TRUE) {
				gint _tmp28_ = 0;
				gint _tmp29_ = 0;
				gint _tmp30_ = 0;
				gchar* host = NULL;
				GeeLinkedList* _tmp31_ = NULL;
				gint _tmp32_ = 0;
				gpointer _tmp33_ = NULL;
				GeeTreeMap* _tmp34_ = NULL;
				const gchar* _tmp35_ = NULL;
				gboolean _tmp36_ = FALSE;
				_tmp28_ = _host_index;
				_host_index = _tmp28_ + 1;
				_tmp29_ = _host_index;
				_tmp30_ = _host_size;
				if (!(_tmp29_ < _tmp30_)) {
					break;
				}
				_tmp31_ = _host_list;
				_tmp32_ = _host_index;
				_tmp33_ = gee_abstract_list_get ((GeeAbstractList*) _tmp31_, _tmp32_);
				host = (gchar*) _tmp33_;
				_tmp34_ = self->priv->hostModules;
				_tmp35_ = host;
				_tmp36_ = gee_abstract_map_has_key ((GeeAbstractMap*) _tmp34_, _tmp35_);
				if (_tmp36_) {
					QeteshWebServerContext* _tmp37_ = NULL;
					QeteshErrorManager* _tmp38_ = NULL;
					const gchar* _tmp39_ = NULL;
					GeeTreeMap* _tmp40_ = NULL;
					const gchar* _tmp41_ = NULL;
					gpointer _tmp42_ = NULL;
					QeteshAppModule* _tmp43_ = NULL;
					const gchar* _tmp44_ = NULL;
					const gchar* _tmp45_ = NULL;
					gchar* _tmp46_ = NULL;
					gchar* _tmp47_ = NULL;
					_tmp37_ = self->priv->context;
					_tmp38_ = _tmp37_->Err;
					_tmp39_ = host;
					_tmp40_ = self->priv->hostModules;
					_tmp41_ = host;
					_tmp42_ = gee_abstract_map_get ((GeeAbstractMap*) _tmp40_, _tmp41_);
					_tmp43_ = (QeteshAppModule*) _tmp42_;
					_tmp44_ = qetesh_app_module_get_Nick (_tmp43_);
					_tmp45_ = _tmp44_;
					_tmp46_ = g_strdup_printf ("Host %s already assigned to another module (%s)", _tmp39_, _tmp45_);
					_tmp47_ = _tmp46_;
					qetesh_error_manager_WriteMessage (_tmp38_, _tmp47_, QETESH_ERROR_MANAGER_QERROR_CLASS_MODULE_WARNING, NULL);
					_g_free0 (_tmp47_);
					_g_object_unref0 (_tmp43_);
				} else {
					GeeTreeMap* _tmp48_ = NULL;
					const gchar* _tmp49_ = NULL;
					QeteshAppModule* _tmp50_ = NULL;
					_tmp48_ = self->priv->hostModules;
					_tmp49_ = host;
					_tmp50_ = loadedMod;
					gee_abstract_map_set ((GeeAbstractMap*) _tmp48_, _tmp49_, _tmp50_);
				}
				_g_free0 (host);
			}
			_g_object_unref0 (_host_list);
		}
		_g_object_unref0 (loadedMod);
	}
	goto __finally3;
	__catch3_g_error:
	{
		GError* e = NULL;
		QeteshWebServerContext* _tmp51_ = NULL;
		QeteshErrorManager* _tmp52_ = NULL;
		QeteshConfigFileModConfig* _tmp53_ = NULL;
		const gchar* _tmp54_ = NULL;
		GError* _tmp55_ = NULL;
		const gchar* _tmp56_ = NULL;
		gchar* _tmp57_ = NULL;
		gchar* _tmp58_ = NULL;
		e = _inner_error_;
		_inner_error_ = NULL;
		_tmp51_ = self->priv->context;
		_tmp52_ = _tmp51_->Err;
		_tmp53_ = mod;
		_tmp54_ = _tmp53_->Nick;
		_tmp55_ = e;
		_tmp56_ = _tmp55_->message;
		_tmp57_ = g_strdup_printf ("Unable to load module %s (%s)", _tmp54_, _tmp56_);
		_tmp58_ = _tmp57_;
		qetesh_error_manager_WriteMessage (_tmp52_, _tmp58_, QETESH_ERROR_MANAGER_QERROR_CLASS_QETESH_WARNING, NULL);
		_g_free0 (_tmp58_);
		_g_error_free0 (e);
	}
	__finally3:
	if (_inner_error_ != NULL) {
		g_critical ("file %s: line %d: uncaught error: %s (%s, %d)", __FILE__, __LINE__, _inner_error_->message, g_quark_to_string (_inner_error_->domain), _inner_error_->code);
		g_clear_error (&_inner_error_);
		return;
	}
}


/**
* Get a module based on provided host
* 
* @param host Hostname to look up
**/
QeteshAppModule* qetesh_module_manager_GetHostModule (QeteshModuleManager* self, const gchar* host) {
	QeteshAppModule* result = NULL;
	QeteshWebServerContext* _tmp0_ = NULL;
	QeteshErrorManager* _tmp1_ = NULL;
	const gchar* _tmp2_ = NULL;
	gchar* _tmp3_ = NULL;
	gchar* _tmp4_ = NULL;
	GeeTreeMap* _tmp5_ = NULL;
	const gchar* _tmp6_ = NULL;
	gboolean _tmp7_ = FALSE;
	g_return_val_if_fail (self != NULL, NULL);
	g_return_val_if_fail (host != NULL, NULL);
	_tmp0_ = self->priv->context;
	_tmp1_ = _tmp0_->Err;
	_tmp2_ = host;
	_tmp3_ = g_strdup_printf ("Attempting to get module for host: %s", _tmp2_);
	_tmp4_ = _tmp3_;
	qetesh_error_manager_WriteMessage (_tmp1_, _tmp4_, QETESH_ERROR_MANAGER_QERROR_CLASS_QETESH_DEBUG, NULL);
	_g_free0 (_tmp4_);
	_tmp5_ = self->priv->hostModules;
	_tmp6_ = host;
	_tmp7_ = gee_abstract_map_has_key ((GeeAbstractMap*) _tmp5_, _tmp6_);
	if (_tmp7_) {
		GeeTreeMap* _tmp8_ = NULL;
		const gchar* _tmp9_ = NULL;
		gpointer _tmp10_ = NULL;
		_tmp8_ = self->priv->hostModules;
		_tmp9_ = host;
		_tmp10_ = gee_abstract_map_get ((GeeAbstractMap*) _tmp8_, _tmp9_);
		result = (QeteshAppModule*) _tmp10_;
		return result;
	} else {
		result = NULL;
		return result;
	}
}


static void qetesh_module_manager_class_init (QeteshModuleManagerClass * klass) {
	qetesh_module_manager_parent_class = g_type_class_peek_parent (klass);
	g_type_class_add_private (klass, sizeof (QeteshModuleManagerPrivate));
	G_OBJECT_CLASS (klass)->finalize = qetesh_module_manager_finalize;
}


static void qetesh_module_manager_instance_init (QeteshModuleManager * self) {
	self->priv = QETESH_MODULE_MANAGER_GET_PRIVATE (self);
}


static void qetesh_module_manager_finalize (GObject* obj) {
	QeteshModuleManager * self;
	self = G_TYPE_CHECK_INSTANCE_CAST (obj, QETESH_TYPE_MODULE_MANAGER, QeteshModuleManager);
	_g_object_unref0 (self->priv->loadedModules);
	_g_object_unref0 (self->priv->hostModules);
	_g_object_unref0 (self->priv->context);
	G_OBJECT_CLASS (qetesh_module_manager_parent_class)->finalize (obj);
}


/**
* Manages the loading of modules
**/
GType qetesh_module_manager_get_type (void) {
	static volatile gsize qetesh_module_manager_type_id__volatile = 0;
	if (g_once_init_enter (&qetesh_module_manager_type_id__volatile)) {
		static const GTypeInfo g_define_type_info = { sizeof (QeteshModuleManagerClass), (GBaseInitFunc) NULL, (GBaseFinalizeFunc) NULL, (GClassInitFunc) qetesh_module_manager_class_init, (GClassFinalizeFunc) NULL, NULL, sizeof (QeteshModuleManager), 0, (GInstanceInitFunc) qetesh_module_manager_instance_init, NULL };
		GType qetesh_module_manager_type_id;
		qetesh_module_manager_type_id = g_type_register_static (G_TYPE_OBJECT, "QeteshModuleManager", &g_define_type_info, 0);
		g_once_init_leave (&qetesh_module_manager_type_id__volatile, qetesh_module_manager_type_id);
	}
	return qetesh_module_manager_type_id__volatile;
}



